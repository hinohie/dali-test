SET(VISUAL_TESTS_SRC_DIR ${ROOT_SRC_DIR}/visual-tests)

# Get all subdirectory names from VISUAL_TESTS_SRC_DIR
MACRO(SUBDIRLIST result curdir)
  FILE(GLOB children RELATIVE ${curdir} ${curdir}/*)
  SET(dirlist "")
  FOREACH(child ${children})
    IF(IS_DIRECTORY ${curdir}/${child})
        LIST(APPEND dirlist ${child})
    ENDIF()
  ENDFOREACH()
  SET(${result} ${dirlist})
ENDMACRO()
SUBDIRLIST(SUBDIRS ${VISUAL_TESTS_SRC_DIR})

FOREACH(VISUAL_TEST ${SUBDIRS})
  FILE(GLOB SRCS "${VISUAL_TESTS_SRC_DIR}/${VISUAL_TEST}/*.cpp")
  SET(SRCS ${SRCS} "${ROOT_SRC_DIR}/common/visual-test.cpp")
  ADD_EXECUTABLE(${VISUAL_TEST}.test ${SRCS})
  TARGET_LINK_LIBRARIES(${VISUAL_TEST}.test ${REQUIRED_PKGS_LDFLAGS} -pie)
  INSTALL(TARGETS ${VISUAL_TEST}.test DESTINATION ${BINDIR})
  FILE(GLOB IMAGES "${VISUAL_TESTS_SRC_DIR}/${VISUAL_TEST}/images/*.*")
  INSTALL(FILES ${IMAGES} DESTINATION "${IMAGES_DIR}/${VISUAL_TEST}")
  FILE(GLOB SCENES "${VISUAL_TESTS_SRC_DIR}/${VISUAL_TEST}/scenes")
  INSTALL(DIRECTORY ${SCENES} DESTINATION "${APP_DATA_RES_DIR}")
  FILE(GLOB RESOURCES "${VISUAL_TESTS_SRC_DIR}/${VISUAL_TEST}/resources/*.*")
  INSTALL(FILES ${RESOURCES} DESTINATION "${RESOURCES_DIR}/${VISUAL_TEST}")
ENDFOREACH(VISUAL_TEST)
